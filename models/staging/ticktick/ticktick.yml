version: 2
models:
  - name: stg__ticktick__tasks
    columns:
      - name: childids
        description: list of subtasks
        config:
          meta: {}
          tags: []
        data_type: ARRAY<STRING>
      - name: column_id
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: completed_time
        data_type: datetime
        description: |
          Timestamp when the task was completed / wont do.
          - Inferred from dbt snapshot.
          - Ticktick API do not provide this field (at least not reliably cause it only retrieve new task).
          - Timezone conversion available with env var DBT_TIMEZONE
        config:
          meta: {}
          tags: []
      - name: due_date
        data_type: datetime
        description: |
          - Task due date time in "yyyy-MM-dd'T'HH:mm:ssZ"
          - Timezone conversion available with env var DBT_TIMEZONE
        config:
          meta: {}
          tags: []
      - name: etag
        description: ephemeral slug generated by ticktick. Not useful for analytics.
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: gtd_work_type
        description: |
          optional field indicating if a task was done under
          - shallow work (during clarification) or 
          - deep work (scheduled properly into next action)
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: is_allday
        description: All day
        config:
          meta: {}
          tags: []
        data_type: BOOLEAN
      - name: kind
        description: '"TASK" or "NOTE"'
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: parent_id
        description: Parent task id
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: priority
        description: 'Task priority. Value : None:0, Low:1, Medium:3, High5'
        config:
          meta: {}
          tags: []
        data_type: INT64
      - name: project_id
        description: Task project id
        data_tests:
          - relationships:
              to: ref('stg__ticktick__projects')
              field: project_id
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: reminders
        description: List of reminder triggers. Example [ "TRIGGER:P0DT9H0M0S", "TRIGGER:PT0S" ]
        config:
          meta: {}
          tags: []
        data_type: ARRAY<STRING>
      - name: repeat_flag
        description: |
          Recurring rules of task.
          - Example : "RRULE:FREQ=DAILY;INTERVAL=1"
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: sort_order
        description: Task sort order
        config:
          meta: {}
          tags: []
        data_type: INT64
      - name: start_date
        data_type: datetime
        description: |
          - Start date time in "yyyy-MM-dd'T'HH:mm:ssZ". 
          - Timezone conversion available with env var DBT_TIMEZONE
        config:
          meta: {}
          tags: []
      - name: status
        description: 'Task completion status. Value : Normal: 0, Completed: 2'
        config:
          meta: {}
          tags: []
        data_type: INT64
      - name: tags
        description: Array of tags assigned to the task.
        config:
          meta: {}
          tags: []
        data_type: ARRAY<STRING>
      - name: task_id
        data_tests:
          - unique
          - not_null
        description: Task identifier
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: timezone
        description: Task timezone
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: title
        description: Task title
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: updated_time
        data_type: datetime
        description: |
          inferred updated time; Only available for completed task
          due to ticktick API limitation we had to workaround with
          snapshots.
        config:
          meta: {}
          tags: []
  - name: stg__ticktick__projects
    columns:
      - name: closed
        description: Project closed
        config:
          meta: {}
          tags: []
        data_type: BOOLEAN
      - name: color
        description: Project color
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: completed_time
        data_type: datetime
        description: |
          Timestamp when the project was closed/archived.
          - Inferred from dbt snapshot.
          - Ticktick API do not provide this field.
          - Timezone conversion available with env var DBT_TIMEZONE
        meta:
          dbt-osmosis-force-inherit-descriptions: false
        config:
          meta: {}
          tags: []
      - name: group_id
        description: Project group identifier
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: kind
        description: "\"TASK\" or \"NOTE\"\n"
        meta:
          dbt-osmosis-force-inherit-descriptions: false
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: last_pulse
        description: |
          - Indicates the last time the project is active.
          - Logic: the (MAX due date or MAX completed at) of each project's task.
          - (Had to anchor on these fields cause there's no reliable updated at for new tasks ðŸ¤·)
        data_type: DATETIME
        config:
          meta: {}
          tags: []
      - name: permission
        description: '"read", "write" or "comment"'
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: project_id
        data_tests:
          - unique
          - not_null
        description: Project identifier
        meta:
          dbt-osmosis-force-inherit-descriptions: false
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: project_name
        description: Project name
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: sort_order
        description: Order value
        meta:
          dbt-osmosis-force-inherit-descriptions: false
        config:
          meta: {}
          tags: []
        data_type: INT64
      - name: view_mode
        description: view mode, "list", "kanban", "timeline"
        config:
          meta: {}
          tags: []
        data_type: STRING
  - name: stg__ticktick__task_tags
    description: |
      - Bridge table to break down tags <> task relation.
      - This is due to our design fact_tasks grain is the task and not the tags.
    columns:
      - name: tag
        description: A single tag assigned to the task.
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: task_id
        description: Task identifier
        config:
          meta: {}
          tags: []
        data_type: STRING
  - name: stg__ticktick__project_folder
    description: |
      - Folders where the projects belong to.
      - Inferred from dummy projects created from user with this specific naming convention : `folder_map - '<the_name>'`
      - Has a failsafe in that if user didn't create dummy label project then we just don't load any data.
    columns:
      - name: folder_id
        description: unique identifer of the folder
        data_tests:
          - unique
          - relationships:
              to: ref('stg__ticktick__projects')
              field: group_id
        config:
          meta: {}
          tags: []
        data_type: STRING
      - name: folder_name
        description: The folder name. Inferred from dummy project manually created by users
        config:
          meta: {}
          tags: []
        data_type: STRING

  - name: stg__ticktick_v3__tasks
    description: |
      TickTick v3 staging tasks with completion semantics sourced directly from first-class v3 status/completed_time.
    columns:
      - name: task_id
        description: Task identifier
        data_tests:
          - unique
          - not_null
        data_type: STRING
      - name: project_id
        description: Task project id
        data_tests:
          - relationships:
              to: ref('stg__ticktick_v3__projects')
              field: project_id
        data_type: STRING
      - name: status
        description: 'Task completion status. Value : Normal: 0, Completed: 2'
        data_type: INT64
      - name: completed_time
        description: Completion timestamp from TickTick v3 payload
        data_type: DATETIME
      - name: updated_time
        description: Last modified timestamp for completed tasks
        data_type: DATETIME
      - name: gtd_work_type
        description: Optional deep or shallow work classification
        data_type: STRING

  - name: stg__ticktick_v3__projects
    description: |
      TickTick v3 staging projects with completion semantics inferred from closed state and modified_time.
    columns:
      - name: project_id
        description: Project identifier
        data_tests:
          - unique
          - not_null
        data_type: STRING
      - name: group_id
        description: Project group identifier with default fallback
        data_type: STRING
      - name: closed
        description: Project closed state
        data_type: BOOLEAN
      - name: completed_time
        description: Timestamp when project became closed based on modified_time
        data_type: DATETIME
      - name: last_pulse
        description: Max project pulse derived from due_date/completed_time of v3 tasks
        data_type: DATETIME

  - name: stg__ticktick_v3__project_folder
    description: |
      Folder map sourced directly from TickTick v3 groups replica.
    columns:
      - name: folder_id
        description: unique identifier of the folder
        data_tests:
          - unique
          - relationships:
              to: ref('stg__ticktick_v3__projects')
              field: group_id
        data_type: STRING
      - name: folder_name
        description: Folder name from TickTick v3 groups replica
        data_type: STRING